\chapter{\textsc{Mulan} Prototyp} \label{cha:mulan_settler}
	Die Siedler oder Settler ist eine Aufbau-Strategiespiele, das unter Verwendung der \textsc{Mulan} (Multi-Agent Nets) Plattform aufgebaut und mit \textsc{Renew} simuliert werden kann. \bigbreak
	Für die Gestaltung der \textsc{Mulan}-Settler Variation wird zunächst der Aufbau der Gesamtumsetzung geschildert und der Zusammenhang der Akteure dargestellt. Anschließend werden Anforderungen erfasst, die der \textsc{Renew} Prototyp erfüllen muss, um die \textsc{Mulan}-Settler Variation der \textsc{Mulan} Plattform zu betreiben. Infolgedessen entsteht ein Implementierungsplan sowie ein Prototyp.

\section{Anforderungen} \label{sec:anforderungen2}
	Der \textsc{Mulan}-Settler \textsc{Renew} Prototyp soll die \textsc{Mulan} Plattform unterstützen, dabei sind nur die für Settler nötigen \textsc{Mulan}-Plugins einzubringen, die auf dem modularen \textsc{Renew} ihre Funktion erfüllen sollen. Das Ergebnis soll eine UI präsentieren und geringe Interaktionsmöglichkeiten anbieten. \newline 
	Ziel des Prototypen ist die Darstellung des parallelen Betriebs von alten und neuen Softwarekomponenten, die mithilfe des Modulsystem von Java zusammengeführt werden können und in der Konsequent als ein Beispiel für eine Migration ohne  Zeitdruck und Betriebsausfall dienen.

\section{Spezifikation}
	Für die Umsetzung des Prototyps muss die minimale \textsc{Renew} Version neu definiert werden, denn die \textsc{Mulan} Plattform im Kontext des Settler Plugins benötigt eine größere Menge an \textsc{Renew} Plugins. Dafür müssen die erforderliche \textsc{Mulan} Plugins für Settler ausgelesen werden, um anschließend die entsprechenden \textsc{Renew} Abhängigkeiten abzuleiten. \newline
	Da die \textsc{Mulan} Plugins auf die Renew-Codebasis angewiesen sind und dessen Klassen für das Kompilieren, Verpacken und das Ausführen der Plugins benötigen, müssen die entsprechenden Referenzen in den \textsc{Mulan} Plugins, Ressourcen und \textit{Ant} Skripten angepasst werden. \newline
	Die Settler und \textsc{Mulan} \textit{Ant} Skripte sollen nicht auf das \textit{Gradle} Werkzeug migriert werden, statt dessen werden lediglich Anpassungen an die neue \textsc{Renew} Struktur durchgeführt. \bigbreak
	Die Basis für diesen Prototypen sollen alle \textsc{Renew} sowie \textsc{Mulan} Plugins aus den Abhängigkeitsgraph des Settler Spiels bilden, die aus der \textit{plugin.cfg} Konfigurationsdatei für die Laufzeitumgebung und aus dem \textit{Ant} Skript für die Kompilierumgebung abgelesen werden können. 


\section{Entwurf}
	Zuerst werden Komponenten in Form der benötigten Plugins aus \textsc{Renew} und \textsc{Mulan} für das Settler Spiel erarbeitet und der Zusammenhang zwischen den Applikationen abgebildet.\bigbreak
	Nachdem die Basis für das Settler Spiel erarbeitet wurde, müssen die \textit{Ant Skripte} an das modulare \textsc{Renew} angepasst werden, damit diese die passenden \textsc{Renew} Klassen für das Kompilieren interner \textsc{Mulan} Strukturen genutzt werden können. Zum Teil werden es interne Plugin Klassen sein und zum Teil werden kritische Ressourcen, wie \textit{Shadow Netze}, mithilfe der \textsc{Renew} Basis übersetzt. Daher ist das nahtlose Verzahnen zwischen \textsc{Mulan} und dem modularen \textsc{Renew} Prototypen das Schlüsselkriterium der Umsetzung. \bigbreak
	Da das modulare \textsc{Renew} auf der Abschlussarbeit von Martin Wincierz \cite{Wincierz18} aufbaut, ist \textsc{Mulan} für die Oberflächenanpassung zu diesem Zeitpunkt nicht bereit und muss nicht nur an das modulare Renew, sondern auch an die erweiterte Oberfläche von \textsc{Renew} angepasst werden.\newline
	Somit ist das Aufsetzen des Settler Spiels und der erforderlichen \textsc{Mulan} Plugins mit Schwierigkeiten verbunden die sorgfältig behandelt werden müssen. 

\section{Umsetzung}
	Zuerst wird die existierende Struktur von \textsc{Mulan} betrachtet und die Settler Abhängigkeit laut den \textit{plugin.cfg's} abgelesen. Dafür werden die Settler Abhängigkeit innerhalb \textsc{Renew} und \textsc{Mulan} betrachtet und ein Abhängigkeitsgraph erstellt. Da die \textsc{Mulan} Plugins auf \textsc{Renew} aufbauen, werden zusätzliche Plugins für die modulare \textsc{Renew} Umsetzung durch den Abhängigkeitsgraphen aufgedeckt. Wie zum Beispiel das \textsc{Renew} \textit{Feature Structure} Plugin, das an der Modellierung von Prozessen und der Erstellung von Ontologien beteiligt ist. \bigbreak

	\begin{figure}[h!]
	  \centering
	  \includegraphics[width=\textwidth]{material/images/settler-mulan-plugins.pdf}
	  \caption{Settler \textsc{Mulan} Plugin Menge}
	  \label{fig:settler_mulan_plugins}
	\end{figure}

	Im Folgenden werden die benötigten \textsc{Renew} Plugins modularisiert und zum ersten Mal das \textsc{Mulan} Settler \textit{target} ausgeführt. Dieses soll das Settler Spiel mit allen nötigen Abhängigkeiten von \textsc{Mulan} sowie \textsc{Renew} kompilieren und verpacken. Jedoch wird man während der Ausführung auf Plugin Klassen verwiesen, die für das Kompilieren notwendig sind und nicht als Teil des Settler \textit{target's} sowie der \textit{plugin.cfg's} gelistet sind. \newline
	Die nachfolge Analyse ergab zusätzliche Abhängigkeiten aus den \textit{Plattform Transport Service} sowie \textit{Subscription Monitor} Plugins, die ein älteres Plugin ersetzen und noch nicht komplett in die Ant Umgebung eingebunden sind. Daher werden diese in den Settler Ant \textit{target} verankert sowie in den \textit{CAPA} Plugin \textit{plugin.cfg} nachgerüstet. In der Konsequenz muss der Abhängigkeitsbaum durch die nachträglichen \textsc{Mulan} Plugins erweitert und auf zusätzlicher \textsc{Renew} Plugins inspiziert werden. \newline
	In den Abbildungen \ref{fig:settler_mulan_plugins} sowie \ref{fig:renew_mulan_plugins} werden die endgültigen Plugin Mengen aus \textsc{Mulan} sowie \textsc{Renew} dargestellt, die Settler für die Ausführung benötigt. \bigbreak

	\begin{figure}[h!]
	  \centering
	  \includegraphics[width=0.9\textwidth]{material/images/settler-renew-tree-extend.pdf}
	  \caption{Minimale modulare \textsc{Renew} Version für Settler}
	  \label{fig:renew_mulan_plugins}
	\end{figure}	

	Im weiteren Fortgang müssen die Klassenpfade innerhalb der \textsc{Mulan} Plugins angepasst werden, denn diese verweisen auf \textsc{Renew} Plugins mit der alten Projektstruktur und werden daher nicht gefunden. Um diesen Zustand zu beheben, wird die Korrektur, mithilfe der regulären Ausdrücke, \textsc{Mulan} übergreifend nachgezogen und enthält zum Schluss keine Referenzen auf alte sowie nicht existierende Paketstrukturen von Renew. Die betroffenen \textsc{Mulan} Plugins sind: UseCaseComponents, YamlToFSConceptDiagram, KnowledgeRoundtrip, MulanDoc, FSOntologyGenerator, SLEditor, WF und das AgentRoleModeler Plugin. \newline
	Mit dem letzten Schritt wurden alle \textsc{Mulan} Java Klassen innerhalb der \textsc{Renew} Plugin Menge richtig verbunden, dennoch bestehen Probleme bei der Referenzierung der Aufrufmethoden. Wie in der Einleitung angedeutet, setzt das modulare \textsc{Renew} auf \textsc{Renew} mit erweiterten Benutzeroberfläche auf und wurde bislang nicht mit \textsc{Mulan} zusammengeführt. Aus diesem Grund kann die \textit{KnowledgeBaseGenerator} Klasse aus dem AgentRoleConverter Plugin nicht auf alle versprochenen Methoden von der erweiterten Benutzeroberfläche zugreifen, wie zum Beispiel das Ausführen eines Speicherdialogs. Dieses fehl Verhalten wird behoben indem Settler auf die angepasste Schnittstelle zugreift und das entsprechende Dialog koordiniert. \bigbreak

	\begin{figure}[h!]
	  \centering
	  \includegraphics[width=0.8\textwidth]{material/images/shadownet.png}
	  \caption{SNS Netz}
	  \label{fig:sns_netz}
	\end{figure}

	Obwohl die Klassen sowie Methoden mit einander verzahnt wurden, müssen zusätzlich Ressourcen unter Verwendung des Ant Werkzeugs und speziell für \textsc{Renew} implementierte \textit{Ant Tasks} generiert werden. Diese nutzen Java Klassen, die in vielen Paketen der \textsc{Renew} Plugins direkt verankert sind. Somit müssen Ant Skripte für die entsprechenden \textit{Task's} adaptiert werden. Zum Beispiel in der \textit{commontasks.xml} für den \textit{CreateShadownetsTask}, der sich jetzt in einem anderen Paket befindet. Dieser ist zuständig für das Kompilieren der \textsc{Renew} Zeichnungen in ausführbare Shadow Netze. Auch wenn der \textit{CreateShadownetsTask} Shadow Netze aus den \textsc{Renew} Zeichnungen generieren kann, gibt es bereits kompilierte Netze die als einfache Ressourcen mit \textsc{Mulan} mitgeliefert werden. \newline
	Im Gegensatz zu den \textsc{Renew} Zeichnungen enthalten die Shadow Netze keine UI-Information, wie zum Beispiel Position oder Färbung der Netzelemente, jedoch enthalten diese Information über den genutzten Netz-Compiler, der für das Kompilieren der Datei zuständig war und für das Öffnen zuständig sein wird. Daher müssen bereits kompilierte \textsc{Renew} Zeichnungen für die modulare \textsc{Renew} Basis angepasst werde. Dafür wird mithilfe eines Text-Editors und einem regulären Ausdruck die entsprechenden Klassenverweise auf den \textit{XFSNetCompiler} aktualisiert, um den Ausführungskontext zu entsprechen. \newline
	Das Ergebnis sowie ein Beispiel für ein aktualisiertes Shadow Netz ist in der Abbildung \ref{fig:sns_netz} dargestellt. \bigbreak
	Zu diesem Zeitpunkt wurden alle Mängel und Uneindeutigkeiten zwischen Settler, \textsc{Mulan} und den modularen \textsc{Renew} beseitigt, dennoch fehlt für die Ausführung die Zeichnung \textit{settler.rnw}. Diese befindet sich im Settler Plugin Projekt und wird nicht in der Standardausführung mitgeliefert, sondern bei Bedarf mit einem \textit{sh} Skript während des Starts nachgeladen. \newline
	Da die Umsetzung auf Settler abzielt, wird dieses Skript im Ant \textit{build} Prozess verankert und in das Settler Plugin mit kompiliert und verpackt. \newline

	\begin{figure}[h!]
	  \centering
	  \includegraphics[width=\textwidth]{material/images/settler-renew-mulan-vm.pdf}
	  \caption{Settler-\textsc{Mulan} Variation}
	  \label{fig:trans_config}
	\end{figure}

	Zusammengefasst ist das Settler Spiel bereit für die Ausführung und enthält alle nötigen Konfigurationen für das modulare \textsc{Renew} mit der erweiterten Oberfläche. Dafür wurden zahlreiche Anpassungen durchgeführt, die eine Brücke zwischen der \textsc{Mulan}-Settler Variation und dem modularen \textsc{Renew} bilden. Es wurden Plugins modularisiert, Ressourcen angepasst, Skripte umgeschrieben und kleine Mängel behoben. \newline
	In der Abbildung \ref{fig:trans_config} ist der fertige Prototyp abgebildet, der die Spezifikation erfüllt und als ein praktisches Beispiel für eine Migration einer existierender Software dient. 

\section{Evaluation}
	Der entstandenen Prototyp deckt ein Migrationsszenario ab, das innerhalb eines Projektes mit einer großen Codebasis entstehen könnte. Die Erwartung eines nahtlosen Austausch von \textsc{Renew} gegen das modulare \textsc{Renew} hat sich nicht ergeben. Alle Änderungen die im entstehenden Prototypen resultieren, deuten auf einen mittleren Arbeitsaufwand für das initiale Aufsetzen von existierendem Alt-Code auf modulare Grundlagen. Es müssen Pfade, Ressourcen und Prozesse angepasst werden, die voraussichtlich alle Bereiche eine Applikation betreffen werden.\newline
	Nichtsdestotrotz ergaben sich auch positive Resultate. Denn, das Erweitern der existierenden Modulmenge ergab ein einfaches, übersichtliches und nachhaltiges Verfahren, welches sich in der erweiterten \textsc{Renew} minimal Konfiguration erwiesen hat. Mit jedem weiteren modularisierten Plugin wurde das Hinzufügen von Plugins zu der Gesamtumsetzung immer simpler und verlangte keinen bis minimalen Aufwand für die benötigen Abhängigkeiten. Zusätzlich steigt ab einem gewissen Punkt die Unterstützung für das Koppeln der Module mit einer intelligenten IDE und bildet somit eine neues, willkommenes Hilfsmittel.
